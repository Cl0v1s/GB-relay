// Include Nodejs' net module.
const Net = require('net');
const { interpret, createMachine, assign } = require('xstate');
// The port number and hostname of the server.
const port = 6374;
const host = '192.168.1.74';

const { 
    MY_OLD_BOY, 
    emulators,
    POKEMON_ROM,
    MY_OLD_BOY_VERSION,
    CONNECT_EVENT,
    RECEIVE_EVENT,
    NEXT_EVENT,
    CLOSE_EVENT,
} = require('./common');
const { choose, raise } = require('xstate/lib/actions');

function receive(buffer) {
    console.log("Receiving from server", buffer.toString("hex"), "or", buffer.toString("ascii"));
}

function send(socket, buffer) {
    console.log("Sending to server ", buffer.toString("hex"), "or", buffer.toString("ascii"));
    socket.write(buffer);
}

const server = createMachine({
    predictableActionArguments: true,
    id: "server",
    initial: 'inactive',
    context: {
        socket: undefined,
        master: undefined,
    },
    states: {
        inactive: {
            on: {
                [CONNECT_EVENT]: {
                    target: "hello",
                    actions: assign({
                        socket: (ctx, event) => event.value,
                    })
                }
            }
        },
        hello: {
            entry: (ctx) => send(ctx.socket, Buffer.from(MY_OLD_BOY, "hex")),
            on: {
                [RECEIVE_EVENT]: {
                    actions: choose([
                        {
                            // scenario 1
                            cond: (ctx, event) => event.value.toString("hex") === MY_OLD_BOY,
                            actions: raise({ type: 'master' })
                        }, 
                        {
                            // scenario 2
                            cond: (ctx, event) => event.value.toString("hex") === `${MY_OLD_BOY}${POKEMON_ROM}`,
                            actions: raise({ type: 'slave' }),
                        },
                        {
                            actions: raise({ type: CLOSE_EVENT })
                        }
                    ])
                },
                slave: 'slave',
                master: 'master',
                [CLOSE_EVENT]: 'inactive',
            }
        },
        master: {
            entry: (ctx) => send(ctx.socket, Buffer.from(`${POKEMON_ROM}${MY_OLD_BOY_VERSION}`, "hex")),
            actions: assign({
                master: true,
            }),
            on: {
                [RECEIVE_EVENT]: {
                    actions: choose([
                        {
                            cond: (ctx, event) => event.value.toString("hex") === POKEMON_ROM,
                            actions: raise({ type: NEXT_EVENT })
                        },
                        {
                            actions: raise({ type: CLOSE_EVENT })
                        }
                    ])
                },
                [NEXT_EVENT]: 'playing',
                [CLOSE_EVENT]: 'inactive',
            }
        },
        slave: {
            entry: (ctx) => send(ctx.socket, Buffer.from(`${POKEMON_ROM}`, "hex")),
            actions: assign({
                master: false,
            }),
            on: {
                [RECEIVE_EVENT]: {
                    actions: choose([
                        {
                            cond: (ctx, event) => event.value.toString("hex") === MY_OLD_BOY_VERSION,
                            actions: raise({ type: NEXT_EVENT })
                        },
                        {
                            actions: raise({ type: CLOSE_EVENT })
                        }
                    ])
                },
                [NEXT_EVENT]: 'slaveVersion',
                [CLOSE_EVENT]: 'inactive',
            }
        },
        slaveVersion: {
            entry: (ctx) => send(ctx.socket, Buffer.from(`${MY_OLD_BOY_VERSION}`, "hex")),
            on: {
                [NEXT_EVENT]: 'playing',
                [CLOSE_EVENT]: 'inactive',
            }
        },
        playing: {
            entry: (ctx) => send(ctx.socket, Buffer.from(
                `00001afc000600001af6789ced9d0b5cd455bec07fe73f4f86c70c884880cc9f878202230209153203a1968d8f4dca1e9888e4b625690f576a50fea8690f372d77b76eebd664b4b22ab4bead34c7dcabb75ba9776f7b6b3fb58ae9a6ed5d85b6ae524cccfd9df3ffcf93875916b59def819939f33fbff3fb9ddff99dc7ffff87990965574fab28ad180700aaa9d74dbdfafa9b316b07fa52021901ee749d07697fd2c993e3ed84c86f2a4fe5f0afc41b85d6f18f4f34dae3eceb8a9a8a404cdaff4661ed8c772727edffe3a467139d9feb55892a2724ed3f7972089c3cb9635c7d8648fe39cbeb8b1f3eafc3fc308009e3e59ced2a9b1a68f72324ba47e1ef71ab65cbd5fa85d1c3b1491728fcbaf7c5a62f57fdeaceadaf5e5a534898166eaaa0de0a57c1a04b5bf7a58054b1a7fd11d4c8af49b63d8264574492ecca28925d632405f6245250319414542693821a3329b66793e28a1c525c6921c535a348b9bd9894578c25e59525a4bcc64aec763bb1574c22f6cac9c45e338554d82b4945c50c5251791ba9a899f98d03ad81f39df04dfb89c3e170381c0e87f375f8f2d83712177abcb38f08a46ac537aa94c3e170061a4d94313729624cd240dbc1e1fcb05833d00670381c0e87c3197874036d0087c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e1f4c61d39db6ff43478109abbe8e7865af2d43dfee781d4ffdecd5f473f8733b01010885a053a3d2680b262f0042444029b24baa0cd84a9ef5ae43abcb930edd455e0517bfcc74597be033afbb6017f8840a68afaf9abe74237e936b5c329f589c0323649b27ddd36f689313061fb3d21a92330f5d27e1db61a9340404e2813e151f9e46d6eda1657903f2912fd91f0512527b592c4fde27ef57efd41386cc204c74497e8b2396d4ed42cdbd02bd4f77a9dc9289a8d209aa506afb698e3d46ba63675a7e026dd81fa651b6c12b6383885b41ff506a750b0cfbc6d6029d47f1ee806b7ba13bc2904b52a38d99ea3a96cad6d6dd95a389a7254df419354672b02398562b559c96258bca41edc548fad51425f504fd8acd0e0f7849c1ed6818b46328d65c59f41ad57f7b43fa8f5281b8ad27b7df90f3af5fdc60f6d33ad418b7e5413d088c7c463b9874dede4ace923531be9c076d749750fcfd7778847e088a9a77ef4297ad72dd5c3626cb155d68aed6ec09cf9dae5b46edb52f509f120c6d42ad11c60096d8dcbdf73822f7e8392cb9b6c128dd81efa03bc87b164ec2f7e98cf43d0808021a4a6da7542a4c9a8ff44f8dc2f6df8cce604a788e35e7451e9d5553df49b4d74e4ea0412a63519b5044b05e9972340c0c8083b071e6d271b730aec1509f98a0426d58811951e2f17ead9e420e45983cd02c4272fa7d47d980ff0b6ed0255fd78a17d07669690d4248c5d8f2960bea4731874dadc827b20adfc363079d71d251507ac1df2ece90aca5119c9bb7630304e71dce3c8662321358946bcec3b5617f39dbec3c666897dddfdd932c20401df43515e14ba5eb05eb8d4c8b3863f85ce3fcadae19b454309f05d6ff38f3f916e3a0b4841be43e83cc9bc27fb4f6465eb3c3adffa2f31cf2de965fdbc14f8e29e25b4e362d75fb4d95b074a5bfb5b7f4c7dc8fb6b801efa65bf05f442efe01e00bdaf8cdfd5b3a95c8a6ffc4a4023b00f79ab3f7ae9ee3364b506799dee67feb4d2751ed87a979a142ccfeaf3adf5a6de566fa03e936be8431e25bdb6f71afdcc7bccf34cbe24401e77d2cafccf6a702fabebc37b3f7a887f1f5904f574c7ecf3a20f097add7f0451de737ff83d2760e7d8ebfe1363de15b8072374c7c9663a79cc0678caeb2f49dee32a3b5c1f0261235401f7cb3dfc8b527d8def6f0f65e7e9db85f9661d5cebea311aa4901d189ba5d99cdf63bf45bab1fffd3b5b26269f07d0d12da2a4d0637fabefa0b33b9ddfe8f80ed2c4e170381c0e87c3e170381c0e87f323831010d46abd5e634a3059459a46e50e4a8a3687190d515aad206810b51af414835ea3d7a975f4b61ebdb44704ad5e1f11a1527d354df1f1c3e6e976afea7cba61755d5b6e755e476657863bfb9f31ceaad09b718d9275fe5e6303ec8506ff251d57aed568d4c173fbeb93dada2eaccd68bddaa581707817dac12a95941697759e8c8f4d329468ac690be12e980ea360083112b350a2f2a83d459ea01b326e551bbb66eef12c5ba6565fb885a3476fdd7a7e6177d4973a8fca433c82f943638c2e6cc523c6e8a11f7a04cf12cfb2534f1ffa64f0df47feb96263f3f49fbc747ac867e1a7877418dbcc6de67d5682425a4f92bbfb430fb1c28ae50f3c70217d92447d56d5d6d6e67275acee301dc9edd4bbd56e75b7e04d6f152cabd777ea3b4d1d556d2b57beb6e5effff3ebbfbff55973e7910e2ae3f5b824b96c2edb856e865e7a3c1ccebf30dff578e2fcf021abcca9611b9a9a5e32ac4fb8714ac316e78b4dcf4d63a4a4fcee8bc31f8c85559b5b5f5cfbb873c3b469401efa62a0ede57c2578b7fe6ba2f37cef77315e03877c7cd780dac1e170383f1ef6118154ad80594767c1928daddb9bb7e0da0eb074dbbad616baf2bf9dfcecb3cf4e5bb5396113be549e661d16b249e8d7b10fce1c12aebca6271551f4c48280142e605e4d8098f08dc1e183c31373c166a3a5d4205ee43a76c173155ee0521508840c191c8e812201bb18f274ac518bcf2f4e6e593056ef7958afa3390926d25c63dc609a53a9ee5b50a2c7353d56433c9eed93d3e99a0e9e18b5e8f13c34f95e3917118325351151c07291fe9c1a3c067f4e031ebd3f47c0131524a70fca45517d7f00cd9df2316a8b66f25377b9040135e859ce256b4fd0b1dc3139374c2ef950f50d5acc65c8255f947389114cc36890f4a17e0bca797ad964d1f79390fb6a80fd8921720399b7618d04ffb81be81fbc3d384a168ed69bb26da60231f70ed809a6dce87f0ae5642299a0b20a3790e7c85ab289d8c874728dea7fc96fc931f237e1341990f3f688644124899a61248ba468c608e9248314927c92a0f91a7f97ac3784eb54e19acb488c8a685444d07c851ac26e0dafd2ddacf929a98c9e416e51576b6e132e4eef25f79a21021fc261450244a8f15519e8c1201fa157ab69970bf26bfc25027b5f39ac3c0a01fffda10a38ee85f47801deff550b296b9eb471ca06739d5b93f4942a1ef216bbb4ca0135356257d55b8921b6ab95e7681c38b09a66456f8dd1746e96c2d5b95047a018f616814b2d95c6d8a0d30415d846b5095657e9e3d273979960ae5455a20721e95e92fb3a11dc875769630aca4b9aae9a0f36b34baece18a03597aa31d9f095b41407e1674204758b0d5c07a9ee257b3d5ddbe6befefca99fdd7f4653fc9ec7b3f5c13dc7ee9e5ffce982bd0d81b500b81e2fdca4ea241d043a09bc9c0cae771eb24a58376d95bb548058b10f470e14387dd07f368a5e00490bc8d005aab405605c00a6052c444cde426ee25d50e5e79a1cdda2dd11bee3887ac8c56825facb00e2d2aed298c874605ef076bbf779a28aa88da698e8419ad8c171aaf884447d681d3154eee3bb60821a4354f2803e4ea58ad3c6a94822d1455b2c1614901f33c68ec44763de58fa681c868fdadbcac65cefbcce73db131f7d30f31ddc6354cd316644ce1c39f881ff7b27add1181bab79186669f5f4af8247c134b8120af0713a1496c1d559f78fd79402ac906dc859285c4d6293938d33a194fa111b85c988a32d0c74a01f03cf3cb1e10aac7f418d986248c930148c152662fd46a307b461d1b47e3ba661982ec7101c7efdb21b6e7cbe11cbdfbd27dca08b8e2d7b7677f3342c6f88fd3308a6b464a57c1e8c8342a8843ce74d115b0b4f63f99a5b52a32347e4e4ddb5e6ed5208370e49f340a986d0fab3a0066e40e3aec4dff2ebe0ed6543efc4f2057306c518cc86b00f63f7a736c6c61a2fbb034a55c50958fe5a4c6371c6888734480ed87a3dd62c5f73c19701ef5ef0e5cacd5bd63ee4dcbc1525573ad7ad6f7d8955b2a27553d366b9be354d5b363ae5972b9b3636b56019dce13dd6b4aaa9c5a750a17bdc2f4d2de2c427c72fdda5d7afb66104b5fd7b8c3d562cd58838f2614df7a2a7dc2d5f74ed9cd0fec5338fef39d5152e9df96bc2dc7747948eabcab889885a9521acaf6f18275a22051815d080317005f621baecc1daa1d885c3e52e34601fb22e4c961e85275a77ee74b6b434050b0e6b9c567d7b2d0a16ce1d94a032c419f49353c6371a938d060f983443075dcc70f18313fbfd69e3e661b59173e477debdff4c6963f2a0d88cf134178543291272c0026648c64ec4e14a3ecd3478a799cf3249b8af2edf557692a88a53699f706e7c69bde26e2d51f17b4cdf1b6efc5bc3409bf05dc3cfff7881fee1e77ffcfc4f869fff85c2cffff8f9df57849ffff1f33f7efec7cffff8f9dff7173cffd3c55cae310d8e8c20c6686d94de608e55c5d385b3b17567c3f16958644872ca88214919c346e689432f4bcd199e1d9750345a29f0212d3038dd322a7790905990a54e2b0c08285ae0042d10d747c4d102276981f87e0afc8d1688eca7c047b4c065fd1438450b44f453e0342d10d54f818f6981987e0a1c6fc312c6fe0a50579afa2b405d19dd5f01eaca84fe0a5057f635f65901eacad03d515001eaca241e0f3c1e02e32170bae8a33087c3e170381c0e87c3f9a1f1dd5c71e07006944430ccdb9369de03f09e1cf7bad4293736c278d8a78da4779062c49c179a9bbababa1c8f351516391c8e48c8fc09000ab01b0ac82dbf5f9745e01ad8a78ba6577d234617afb1b4667539bac2d30b77a1dc43909392b5e7e82c8045b2404ddac111801a048d995ec85fd6b4bda9c981e51d4256ebe599798eff5ef8d8fb6b6f12b490f3ae2cf0a5f8eb42400da8975ec978727d41eac8ccf4ae47331f6d1e3db24bd0ee81c22c00aac1260bec9e7dc84250035187d3db1c6848111a823f02bb6cec10c1767f7c260aa8cfc802c6a965d75181d2c8247a3165f966cb1fb665a68e74a080e5721418011340d6a0dc1d89fa9329937aa95428a6f7af5636e7e7378d76b6a475611bb6676e71bc0afbfe547d070a685db2c007e71f9dcc344424d08b2df162ce26f1c1e31f7cc84c4281deef78c054efed8e0831757deb28073622bc9935e5bf606f4a26bd3e4d68a3d188a909eb8713b81b4a35e1b4e38c05c386d1fe7230b736e7f5a561720f0d8ec73299062bd4c88d167265818fc86715b40d6586187a977345ebb6b4e616b4063558a85b87405a5626f3d259827512987d7a784e23d442a99a99841a465b5a6857cb97ef1d2f40cebe99b680586abebd6d5223dc06c775e13496066534edae5f521fe17663f0edc2a6182173f6bc11f4a27c6e78b42a5c43565f33f29a4638841ab44616ada33758d020d42037ba471bfe3325e93ada71f3e5362ccfdcb4a9893d2cd968d98ec177e58c9c6c0b6bc35a59e0dddfdf67671da7194abda4cfb26c634e722c911b6d82142534aa648182aa8ff31a611c9a3494061f118b465b0a1493684f4734164f9a6242812b6f8e1d64ca8c31fcdb8e8e4cfab9a0d8067aa94fc8c8dcec4cedf26ac8731c80338a066500193ffffba4e534bc35066a526c8e65470e2ddf45fb01351c865d596f65a3804a9405a69f1e6b61d12a373a26c7821d4ddda468180a86aca0f1b0de7a6e2415102213e878d05946b714d139a04b19a2fe9e564c3af717cf2c2a304b134e4d8ab16ccc7cc1c1da8003084df2b541755a1698f070e3d4a5b40d0683416ec39816a641e9b85c48c9db974bc35b090de36f66b23610659ac9cccb2f420d5db2495b1c27a0e0e45c0b0a981e94056ae74ccca61d576d4ca6a1b1a675db8b2f6e533a8e8ee91e26bd7557ccf4477b31499e35f21ceb71e64b638d1e2c0b387f9b389d6a98afd2d07bf7dacc51794534babb50809a6401c394c99368f08162d2750b7fce62491f4de79125ebb76d6da26da65edade9b4963ee5d243e1262120d25a6014d5a06ab83050e9189d3a897c61b12a8802a333fbf953ac9a1cc4b2df0cacf539ea46d5078f5d5573b25a88714c23e02373c7de72e367e1c4c432f263df0ecaf6c2b824cc2e093ddca42a319d2263cb20b05f46b64814f179465b07e884aa6579197b6b6885bd337b6fae6d6eca5d74cba361f05ac394683568c8bbbf7966313089ca777fde8f5d895adad395b329a5bd2e9344335ecc489eca69751203d47d650f5cef02c362fc50ea53db3c4b9755873de7aff34530caf14060dd1e1676fc9631da7d6d021baaa7563e60ef1776c88b2689dbb26257fee9b2860d8250b444d7a84692051a9b40d4f6e4acfcadab544ccf72e5935552915a3e1d1bdbe15e8ecd9b377d135ae4ebed11e91b9a9791d1da15d865d1b9bd0bf6f40ca8efbff14e0d6fb32a20b9806431a75ebaae69cf497322c39e9d44bb40dd19062da538d02ba4f65817b4a67b09e2e93c37b55f30bc3d32d5bf32d5d8a5bab206566de8c8015e8ca2fc3a6500db3e41568c9fa6667cb5687b2ec622cddf4fc9ebcfa7b1fd90f667f1b164ab8ecfe147b9986b7d89cc5d685ae479cebfe50909eb70072de92ddaaf0c7d1e74637c2e3504ae2682c0db20c4f7f29539e04582c8dfb479cf1974ce07df94f5ffe92be654c23bc8b73ab96ae0f4b9d9b3739739a5bbad81045b74e81d6949c890103a87bc3d669cc4b7a131d40d2c6a69dcd5bd824200fd1bad33f9bd93816053294bb09e6a78acaa99774b1c3681ba41ce7cad6967c678b5369f486472bc6d63e112060d95b52480562640121c35230aa886d1de4b9b5a1d7dbc2285015954443235a7c213387794999f9064156f5fd7432d6e4cb02ffa83f24f774780cbd451c7d4df62e36797bb70e47178d7dffdc521448192f0bc4955c3f9c6aa02f69c7b56eceb36c742ab3370a9c818aab1b9fa326297f4e76fc9e1122d52018d36968a8551a36152b633acff13ca4ec0bdacddc3dd3359e0aa40802f5f4634e8d655b734b936f6eedd3a47be3121593b65093babc23ee4202832c45967c671713b0509386ad146b7fff010adc7a7cb0a81b2426b09bf8c0eee0d3bf8489b614168a39394d0eef4436d0fb660e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3f9b681ef01f47f01d52ad0e931019415077cbd3db34f029b24baa0cd84a9ef5ae43abcb930edd455e05107b44f74e93ba0b36f1be8676a0b64aaa89fbf7a2e74936e533b9c529f082c639324dbd76d639f180313b6df13923a02532fedd761ab310904e4443f5bdfa3f2c9dbdcb42dae207f5224fa2349f453c759522b49dc2fee57efd71f84c3264c704c74892e9bd3e644cdb20dbd427dafd7998ca2d908a2596af06a8b394ebd666a53770a6ed20d219f134ffb155b1c9c42da8f7a835328d867de36b014ea3f0f74835bdd09de14825a159c6ccfd154b6d6b6b66c2d1c4d39aaefa049aab315819c42b1daac64312c5e520f6eaac7d628a12fa8276c5668f07b424e0febc0452399c6b2e2cfa0d6ab7bda1fd47a940d45e9bdbefc079dfa7ee387b699d6a0453faa0968c463e2b1dcc3a67672d6f491a98d7460bbeba4ba87e7eb3bc42370c4d4533ffa14bdeb96ea6131b6d82a6bc5763760ce7ced725ab76da9fa847810636a95680eb084b6c6e5ef39c117bf41c9e54d3689466c0ffd01dec35832f6173fcce7216840c0105253ed3a21d264d47f227cee97367c66738253c4712fbaa8f4eaaa1efacd263a72750209d39a8c5a82a582f4cb11206064849d038fb6938d3905f68a847c323d936ac4884a973ff735a07cafc8b3069b05884f5e4ea9fb301fe06ddb05aafaf142fb0ecc2c21a94918bb1e53c07c49e730e8b4b905f7405af96d60f2ae3b4a2a0e583be4d9d31594a3329277ed60609ce2b8c791cd46426a128d78d977ac2ee63b7d878dcd12fbbafbb36584091afcb9f2a2d0f582f5c2a5469e35fc2974fe51d60edf2c1a4a80ef7a9b7ffc8974d359400af21d42e749e63dd97f222b5be7d1f9d67f89796e492febe7a5c017f72ca11d17bbfea2cdde3a50dadadffa63ea43de5f03f4d02ffb2da0177a07f700e87d65fcae9e4de5527ce357021a817dc85bfdd14b779f21ab35c8eb743ff3a795aef3c0d6bbd4a46079569f6fad37f5b67a03f5995c431ff228e9b5bdd7e867de639e67f22501f2b89356e67f56837b595d1fdefbd143fcfbc822a8a73b669f177d48d0ebfe2388f29efbc3ef39013bc75ef79f18f3aec03d18a13b4e36d3c96336c0535e7f49f21e57d9e1fa10081ba10ab85feee15f94ea6b7c7f7b283b4fdf2ecc37ebe05a578fd12085ecc0d82ccde6fc1efb2dd28dfdefdfd93231f93c808e6e1125851efb5b7d079ddde9fc46c77790a6ef849292ea6a97ebd0a10307e6ccb15a01e2916c64f1e2f1e3dbdb014e9d9a3d7b21722bf2e69b00ddddd5d5f5f535355555d5d5ddb89abbddd5d53535f23b1d1d343f07a9afbffbee3973ce9d53a9dadbe7cca9ab9b3b97e667cf565c684e4c4c4ea69ae4fca245b5b50f3c505b7bfbed72fed4a9952bdbdb972e3d7b56ce3ff8e0ecd90e07fd95f3f3e6cd99f3d14773e60c1f2ee78b8aaaaaeaeae2e3e7cfefd9bef8788bc56a6d401c8e4f10effb92e472391139477c7cf24947c7f1e32790538cb6b623473a189d0c12427bfb591fed485dddeeddf5f5c50af5f5f2777ff9b7f9b4ce1327bc35befcb21ba9473a3b4f33fc966b345aadd1b8678fc73373a6c7d3d0e0f17cfeb9db7d04a1b6b7b551f9fafa6f1e011c0ee7c74a7dd181f2579e59b7ee95670e94d7b3dd4bfba9dada79f366cd9af753b9c46b493b76bcf6daf2e5af29df4cd7d9e1727575c5c7772ab3eda2bac8c8456367cd5aa4cc45e74fec609c57ae9d7eb0f62d9995723e3fffaaab0a917ce5f3d0aaaa8cc65a869ccfcd753876ecd8b973e756af8dbb77efd83166cc8e1d722e3edef1c0fb88e301eff1365715d2e6927325c9b98c9264eff1f3a7de7efbd0a1c307bdf9b163e722252572cee53a73e66dc47f7ccf9ead94cddefcb1c395952b561c3beaaf7f0ce2adff8b7bdf7fbfab8b5a24e7c3c31313bb5ebdf5d644e5cb640e1ed46ae9ef81038a3f778f19437fc78c51acfbf4c081f3e70f1c38774ecebfff9ba3478f7ee0af2f3e5ea54a6478ed39faf84dc86d93210017025f83865ee0c7f9f1af7a9cf3c366a0e3871fff611fe770381c0e87c3e170381c0e87c3e170381c0e87c3e170381c0e87c3e10c2cd9f608925d1149b22ba348768d9114d8934841c5505250994c0a6acca4d89e4d8a2b724871a58514d78c22e5f662525e319694579690f21a2bb1dbedc45e3189d82b27137bcd145261af241515334845e56da4a26626b9b00503cd1d39db6ff434783f0be1a29f1b6ac953f7c8cfefdd7cf1da3d500f87fd596178c3559b1ea25fcc2bf91f16463f162810944efc82bd7bf2e4c9d53a2cdead94e981f75f973e0f79ff438df8e51b70c5cb0043486c36be711aae08953d37b54fe329bad5f4bf1b9e8653aec063048628ffdef10bf86b0fc9fd33d46fc21bf04618bebe829526901d4b86b08335a77ff35240d9ffe8f13f81585e3779f0f58a11768006fcd56ca2ef276f9f6febc35a62690bc865dbcbff1f97c0b9fc`,
                "hex",
            ))
        
        },
        goodbye: {

        }
    }
});

const serverActor = interpret(server);
serverActor.subscribe((state) => console.log(state.value))
serverActor.start();


// Create a new TCP client.
const client = new Net.Socket();
// Send a connection request to the server.

client.connect(port, host, function() {
    serverActor.send({ type: CONNECT_EVENT, value: client })
});

// The client can also receive data from the server by reading from its socket.
client.on('data', function(chunk) {
    receive(chunk);
    serverActor.send({ type: RECEIVE_EVENT, value: chunk });
});

client.on('end', function() {
    console.log('Requested an end to the TCP connection');
});